## The WirePlumber configuration

context.properties = {
  ## Properties to configure the PipeWire context and some modules

  # application.name = WirePlumber
  log.level = 2
  wireplumber.script-engine = lua-scripting
  # wireplumber.export-core = true
  # mem.mlock-all = false
  # support.dbus  = true
}

context.spa-libs = {
  ## PipeWire SPA Factories to load.
  ## Used to find spa factory names. It maps an spa factory name
  ## regular expression to a library name that should contain
  ## that factory.
  ##
  ## Syntax:
  ## <factory-name regex> = <library-name>

  api.alsa.*      = alsa/libspa-alsa
  api.bluez5.*    = bluez5/libspa-bluez5
  api.v4l2.*      = v4l2/libspa-v4l2
  api.libcamera.* = libcamera/libspa-libcamera
  audio.convert.* = audioconvert/libspa-audioconvert
  support.*       = support/libspa-support
}

context.modules = [
  ## PipeWire modules to load.
  ## If ifexists is given, the module is ignored when it is not found.
  ## If nofail is given, module initialization failures are ignored.
  ##
  ## Syntax:
  ## {
  ##    name = <module-name>
  ##    [ args = { <key> = <value> ... } ]
  ##    [ flags = [ ifexists | nofail ] ]
  ## }

  ## Uses RTKit to boost the data thread priority.
  {
    name = libpipewire-module-rt
    args = {
        nice.level   = -11
        # rt.prio      = 88
        # rt.time.soft = -1
        # rt.time.hard = -1
    }
    flags = [ ifexists, nofail ]
  }

  ## The native communication protocol.
  { name = libpipewire-module-protocol-native }

  ## Allows creating nodes that run in the context of the
  ## client. Is used by all clients that want to provide
  ## data to PipeWire.
  { name = libpipewire-module-client-node }

  ## Allows creating devices that run in the context of the
  ## client. Is used by the session manager.
  { name = libpipewire-module-client-device }

  ## Makes a factory for wrapping nodes in an adapter with a
  ## converter and resampler.
  { name = libpipewire-module-adapter }

  ## Allows applications to create metadata objects. It creates
  ## a factory for Metadata objects.
  { name = libpipewire-module-metadata }

  ## Provides factories to make session manager objects.
  { name = libpipewire-module-session-manager }

  # Provides factories to make SPA node objects.
  { name = libpipewire-module-spa-node-factory }
]

wireplumber.components = [
  ## WirePlumber components to load
  ## name and type are mandatory rest of the tags are optional.
  ##
  ## Syntax:
  ## {
  ##   name = <component-name>
  ##   type = <component-type>
  ##   Higher the value higher the priority
  ##   priority = <value>
  ##   deps = [ <component-dependencies> ]
  ##   flags = [ ifexists | nofail ]
  ## }

  ## Settings provider
  {
    name = libwireplumber-module-settings,
    type = module
    ## highest priority
    priority = 150
  }

  ## The lua scripting engine
  {
    name = libwireplumber-module-lua-scripting,
    type = module
    priority = 140
  }

  ## Session item factories
  {
    name = libwireplumber-module-si-node,
    type = module
    ## default priority for session item modules
    priority = 130
  }

  {
    name = libwireplumber-module-si-audio-adapter,
    type = module
    ## default priority for session item modules
    priority = 130
  }

  {
    name = libwireplumber-module-si-standard-link,
    type = module
    ## default priority for session item modules
    priority = 130
  }

  {
    name = libwireplumber-module-si-audio-virtual,
    type = module
    ## default priority for session item modules
    priority = 130
  }

  ## API to access default nodes from scripts
  {
    name = libwireplumber-module-default-nodes-api,
    type = module
    ## These modules may be needed by other modules, so they assume higher
    ## priority than regular modules.
    priority = 120
  }

  ## API to access mixer controls, needed for volume ducking
  {
    name = libwireplumber-module-mixer-api,
    type = module
    ## These modules may be needed by other modules, so they assume higher
    ## priority than regular modules.
    priority = 120
  }

  ## Provide the "default" pw_metadata
  {
    name = libwireplumber-module-metadata,
    type = module
    ## regular module default priority
    priority = 110
  }

  ## Module listening for pipewire objects to push events
  {
    name = libwireplumber-module-standard-event-source,
    type = module
    ## regular module default priority
    priority = 110
  }

  ## Module managing the portal permissions
  {
    name = libwireplumber-module-portal-permissionstore,
    type = module,
    ## regular module default priority
    priority = 110
    deps = [ access-enable-flatpak-portal ]
  }

  ## Needed for device reservation to work
  {
    name = libwireplumber-module-reserve-device,
    type = module,
    ## regular module default priority
    priority = 110
    deps = [ monitor.alsa.reserve ]
  }

  ## Needed for logind to work
  {
    name = libwireplumber-module-logind,
    type = module,
    ## regular module default priority
    priority = 110
    deps =  [ monitor.bluetooth.enable-logind ],
    flags = [ ifexists ]
  }

  ## Needed for MIDI monitor to work
  {
    name = libwireplumber-module-file-monitor-api,
    type = module,
    ## regular module default priority
    priority = 110
    deps = [ monitor.alsa.midi.monitoring ]
  }

  { name = monitors/alsa.lua, type = script/lua, priority = 101 }
  { name = monitors/bluez.lua, type = script/lua, priority = 101 }
  { name = monitors/bluez-midi.lua, type = script/lua, priority = 101 }
  { name = monitors/alsa-midi.lua, type = script/lua, priority = 101 }
  { name = monitors/v4l2.lua, type = script/lua, priority = 101 }
  { name = monitors/libcamera.lua, type = script/lua, priority = 101 }

  { name = default-nodes/apply-default-node.lua, type = script/lua, priority = 100 }
  { name = default-nodes/find-echo-cancel-default-node.lua, type = script/lua, priority = 100 }
  { name = default-nodes/state-default-nodes.lua, type = script/lua, priority = 100 }
  { name = default-nodes/find-best-default-node.lua, type = script/lua, priority = 100 }
  { name = default-nodes/select-default-nodes.lua, type = script/lua, priority = 100 }

  { name = linking/find-best-target.lua, type = script/lua, priority = 100 }
  { name = linking/find-defined-target.lua, type = script/lua, priority = 100 }
  { name = linking/link-target.lua, type = script/lua, priority = 100 }
  { name = linking/prepare-link.lua, type = script/lua, priority = 100 }
  { name = linking/filter-forward-format.lua, type = script/lua, priority = 100 }
  { name = linking/find-default-target.lua, type = script/lua, priority = 100 }
  { name = linking/rescan.lua, type = script/lua, priority = 100 }
  { name = linking/move-follow.lua, type = script/lua, priority = 100 }

  { name = device/apply-routes.lua, type = script/lua, priority = 100 }
  { name = device/find-best-profile.lua, type = script/lua, priority = 100 }
  { name = device/select-routes.lua, type = script/lua, priority = 100 }
  { name = device/find-best-routes.lua, type = script/lua, priority = 100 }
  { name = device/state-profile.lua, type = script/lua, priority = 100 }
  { name = device/state-routes.lua, type = script/lua, priority = 100 }
  { name = device/apply-profile.lua, type = script/lua, priority = 100 }
  { name = device/select-profile.lua, type = script/lua, priority = 100 }

  { name = client/access-portal.lua, type = script/lua, priority = 100 }
  { name = client/access-default.lua, type = script/lua, priority = 100 }

  { name = node/create-item.lua, type = script/lua, priority = 100 }
  { name = node/suspend-node.lua, type = script/lua, priority = 100 }
  { name = node/state-stream.lua, type = script/lua, priority = 100 }
]

wireplumber.settings = {
  ## This main config file is only supposed to contain the common settings and
  ## rules. rest of the settings and rules are distributed across
  ## wireplumber.conf.d/*.conf files.

  ## If this is true, the settings will be read from conf file only once and for
  ## subsequent reboots they will be read from the state files, till the time
  ## the setting is set to false.
  # persistent.settings = false
}

